# yaml-language-server: $schema=https://raw.githubusercontent.com/grafana/cog/main/schemas/veneers.json

language: all

package: dashboardv2beta1

builders:
  ############
  # Manifest #
  ############

  - add_factory:
      by_name: Dashboard
      factory:
        name: manifest
        builder_ref: {referred_pkg: resource, referred_type: Manifest}
        comments:
          - "Creates a resource manifest from a Dashboard."
        arguments:
          - &name_argument
            name: name
            type: &type_string
              kind: scalar
              scalar: {scalar_kind: string}
          - &spec_argument
            name: dashboard
            type:
              kind: ref
              ref: {referred_pkg: dashboardv2beta1, referred_type: Dashboard}
        options:
          - name: apiVersion
            parameters:
              - constant:
                  value: "dashboard.grafana.app/v2beta1"
                  type: *type_string
          - name: kind
            parameters:
              - constant:
                  value: "Dashboard"
                  type: *type_string
          - name: metadata
            parameters:
              - factory:
                  ref: { package: resource, builder: Metadata, factory: named }
                  parameters:
                    - { argument: *name_argument }
          - name: spec
            parameters:
              - { argument: *spec_argument, force_build: true }

  ##############
  # RowsLayout #
  ##############

  - add_factory:
      by_name: Rows
      factory:
        name: rows

  - add_factory:
      by_name: Row
      factory:
        name: row
        arguments:
          - &title_argument
            name: title
            type: *type_string
        options:
          - name: title
            parameters:
              - { argument: *title_argument }

  ##################
  # AutoGridLayout #
  ##################

  - add_factory:
      by_name: AutoGrid
      factory:
        name: autoGrid

  - add_factory:
      by_name: AutoGridItem
      factory:
        name: autoGridItem
        arguments:
          - *name_argument
        options:
          - &name_option
            name: name
            parameters:
              - { argument: *name_argument }

  ##############
  # TabsLayout #
  ##############

  - add_factory:
      by_name: Tabs
      factory:
        name: tabs

  - add_factory:
      by_name: Tab
      factory:
        name: tab
        arguments:
          - &title_argument
            name: title
            type: *type_string
        options:
          - name: title
            parameters:
              - { argument: *title_argument }

  ##############
  # GridLayout #
  ##############

  - add_factory:
      by_name: Grid
      factory:
        name: grid

  - add_factory:
      by_name: GridItem
      factory:
        name: gridItem
        arguments:
          - *name_argument
        options:
          - *name_option
